# 05 后端接口开发与国内AIGC能力集成

## 1. 服务分层

- API Gateway：鉴权、限流、灰度
- User Service：账号、资料、权限
- Source Service：信息源导入与链接校验
- Cognition Service：卡片、脑图、冲突标记
- Discussion Service：每日一问与苏格拉底追问
- Challenge Service：任务与作品
- Billing Service：计费、订单、订阅
- Audit Service：内容审核与日志

## 2. 模型路由策略

- 轻量模型（导读、摘要、脑图）
- 旗舰模型（计划生成、深度追问、能力报告）
- 本地模型（端侧Agent训练，服务端下发参数与模板）

## 3. 调用治理

- 幂等键：避免重复扣费
- 超时重试：轻量任务2次、重任务1次
- 熔断降级：模型不可用时返回“稍后重试+兜底模板”
- 成本埋点：每次调用记录token、时延、费用

## 4. 合规链路

1) 请求前：敏感词检测
2) 生成中：策略模板约束（不生成违规指令）
3) 响应前：AIGC审核接口二次校验
4) 展示前：客户端标签提示
